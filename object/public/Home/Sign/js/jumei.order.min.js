window.Jumei||(window.Jumei=new Object),window._adwq=window._adwq||[],Jumei.Order={CartProductObj:"",DefaultValue:[],WebSite:[],init:function(){"Cart"==RM_CONTROL&&"show"==RM_ACTION&&(Jumei.Order.CartProductObj=$("#cart_products"),Jumei.Order.enableCartProductAction(),Jumei.Order.RedrawCrossSale(),Jumei.Order.caculate_amount_func(),Jumei.Order.enableHuangouTabs(),Jumei.Order.enableAjaxCrossale(),is_semwinner&&Jumei.Order.enableADWQTracking.track_add("cart"),Jumei.Order.enableGATracking.track_add("view_old")),"Cart"!=RM_CONTROL||"confirmation"!=RM_ACTION&&"check"!=RM_ACTION||(Jumei.Order.enableCartConfirmation(),Jumei.Order.enableDefaultValue()),"Cart"==RM_CONTROL&&"confirmation"==RM_ACTION&&Jumei.Order.enableGATracking.track_confirmation("view"),"Cart"==RM_CONTROL&&"check"==RM_ACTION&&Jumei.Order.enableGATracking.track_check("view"),"Cart"==RM_CONTROL&&"pay"==RM_ACTION&&(Jumei.Order.enableGATracking.track_pay("view"),is_semwinner&&Jumei.Order.enableADWQTracking.track_pay()),"Cart"==RM_CONTROL&&"payment_status"==RM_ACTION&&Jumei.Order.enableGATracking.track_payment(),"Cart"==RM_CONTROL&&"shipping_single"==RM_ACTION&&(Jumei.Order.enableCartConfirmation(),Jumei.Order.enableDefaultValue()),"Cart"!=RM_CONTROL||"pay"!=RM_ACTION&&"check"!=RM_ACTION||Jumei.Order.enableCreditTopupLightbox(),"LotteryWheel"==RM_CONTROL&&"receive"==RM_ACTION&&(Jumei.Order.enableCartConfirmation(),Jumei.Order.enableDefaultValue()),Jumei.Order.cancel(),Jumei.OrderConfirmation&&Jumei.OrderConfirmation.init(),$(".sp_icon").hover(function(){$(this).find(".sp_icon_pos").show()},function(){$(this).find(".sp_icon_pos").hide()})},enableCartProductAction:function(){Jumei.Order.CartProductObj.find(".item-buy-quantity-input").click(function(){$(this).select()}).blur(function(){Jumei.Order.cart_item_quantity_change($(this))}).keyup(function(){Jumei.Order.cart_item_quantity_change($(this))}),Jumei.Order.CartProductObj.find(".buy_number_input").not(".disable").children(".decrease_num").click(function(){var a=$(this).parent().find(".item-buy-quantity-input"),b=parseInt(a.val())-1;b>0&&(a.val(b),Jumei.Order.cart_item_quantity_change(a))}),Jumei.Order.CartProductObj.find(".buy_number_input").not(".disable").children(".increase_num").click(function(){var a=$(this).parent().find(".item-buy-quantity-input"),b=parseInt(a.val())+1;b>0&&21>b&&(a.val(b),Jumei.Order.cart_item_quantity_change(a))}),Jumei.Order.CartProductObj.find(".item-buy-delete").click(function(){var a=confirm("确定要不购买此商品？");a&&(is_semwinner&&Jumei.Order.enableADWQTracking.track_add("delete"),Jumei.Order.enableGATracking.track_add("delete_old"),$("#"+$(this).attr("alt")).remove(),Jumei.Order.RedrawCrossSale(),$.ajax({url:"http://cart.jumei.com/i/cart/ajax_update_cart",type:"POST",dataType:"text",data:{_ajax_:1,item_key:$(this).attr("alt"),update_quantity:0,cart_key:$(this).attr("cart_key")},success:function(a){var a=$.parseJSON(a);$("#J_redeem_amount").val(a.redeem_amount),Jumei.Order.caculate_amount_func()}}))})},RedrawCrossSale:function(){var a=Jumei.Order.CartProductObj.find(".cart_item"),b=new Array;a.length>0&&a.each(function(){b.push($(this).attr("deal_hash_id"))}),$("#product_list .cross_sale_deal").each(function(){var a=$.inArray($(this).attr("deal_hash_id"),b);"-1"!=a?$(this).css("display","none"):$(this).css("display","inline")})},enableHuangouTabs:function(){if($(".sale_gifts_tabs").length>0){var a=$("#J_redeem_amount").val();Jumei.Order.changeHuangouStatus(a);var b=$(".til",".sale_gifts_tabs");b.hover(function(){var a=$(this).attr("level");b.removeClass("current"),$(this).addClass("current"),$(".gifts_container",".sale_gifts_tabs").hide(),$("#level_"+a).show()}),$(".gifts_container .button").hover(function(){if($(this).find(".btn_overlay").length>0){var a=$(".sale_gifts_tabs .current").attr("level"),b=$('<div class="gift_tips box_yellow">您购物车的商品金额不满足换购条件，需大于'+a+"元才可以购买喔</div>");$("#body").append(b),$(this).mousemove(function(a){var c=$("#body").scrollTop()+a.pageY-30,d=$("#body").scrollLeft()+a.pageX+15;b.css("left",d).css("top",c)})}},function(){$(".gift_tips").remove()})}},changeHuangouStatus:function(a){if($(".sale_gifts_tabs").length>0){for(var b=$(".title_tabs .til",".sale_gifts_tabs"),c=b.length,d=[],e=$('<div class="btn_overlay">加入购物车</div>'),f=0;c>f;f++)d.push(parseFloat(b.eq(f).attr("level")));for(var f=0;c>f;f++)a>=d[f]?$(".gifts_container").eq(f).find(".btn_overlay").length>0&&$(".gifts_container").eq(f).find(".btn_overlay").remove():0==$(".gifts_container").eq(f).find(".btn_overlay").length&&$(".gifts_container").eq(f).find(".button").append(e)}},enableAddCrossSaleToCart:function(){var a="http://cart."+RM_SITE_MAIN_TOPLEVELDOMAINNAME+"/i/cart/new_items/";$("a.add_to_cart",".product_list").live("click",function(){if($(this).parent().parent().find("select").length>0)return alert("请先选择一个型号吧！"),!1;var b=$(this).attr("hash_id"),c=$(this).attr("sku_no"),d=$(this).parent().parent().find(".pic a").attr("href"),e="?from="+d.slice(d.indexOf("?")+6,d.length);if(window._gaq=window._gaq||[],c=c.substring(0,c.length-1),c=c.split(","),1==c.length)Jumei.Core.ga_event("addtocart",RM_CONTROL+"_"+RM_ACTION,b),window.location.href=a+c+","+b+",1"+e,window.event&&(window.event.returnValue=!1);else{var f='<div style="position: relative;"><select style="position: absolute;left: 15px;height: 18px;"><option value="">请选个您需要的型号</option>',g=$(this).attr("sku_name");g=g.substring(0,g.length-1),g=g.split(",");for(var h=0;h<c.length;h++)f+='<option value="'+c[h]+'">'+g[h]+"</option>";f+="</select></div>",$(this).parent().after(f)}$(this).parent().parent().find("select").bind("change",function(){""!=$(this).val()&&(Jumei.Core.ga_event("addtocart",RM_CONTROL+"_"+RM_ACTION,b),window.location.href=a+$(this).val()+","+b+",1"+e,window.event&&(window.event.returnValue=!1))})})},enableCartConfirmation:function(){var a=$("#express_selector"),b=$("#address_selector"),c=$("#shipping_selector"),d=$("#prefer_delivery_day"),e=$("#merge_shipping_delivery_fee_redcuction"),f=$("#delivery_fee"),g=$("#merge_shipping_list"),h=$("#shipping_input_delay"),i=function(a){a.parent(".option_box").parent().children(".option_box").removeClass("selected"),a.parent().addClass("selected"),a.attr("checked","checked")};b.find("input[name=address_id]").click(function(){"new_address"==$(this).attr("id")?$("#address_table").show():$("#address_table").hide(),i($(this)),$(this).parent().siblings(".editAddressForm").hide(),Jumei.Order.load_shipping(a.find("input[name=logistic_preference]:checked").val(),$(this).val())}),a.find("input[name=logistic_preference]").click(function(){return $(this).parent().hasClass("disable")?!1:(f.val($(this).attr("delivery_fee")),0!=parseInt(e.val())&&e.val($(this).attr("delivery_fee")),Jumei.Order.load_shipping($(this).val(),b.find("input[name=address_id]:checked").val()),Jumei.Order.update_checkout_amount(),i($(this)),void 0)}),d.find("input[name=prefer_delivery_day]").click(function(){i($(this))}),c.find("input[name='shipping_option']").click(function(){"merge"==$(this).val()?(g.show(),h.hide(),e.val(f.val())):"delay"==$(this).val()?(e.val(0),g.hide(),h.show()):(e.val(0),g.hide(),h.hide()),Jumei.Order.update_checkout_amount(),i($(this))});var j=1,k=10,l=new Date,m=l.getFullYear()+"/"+(parseInt(l.getMonth())+1)+"/"+l.getDate();l=new Date(m);var n=new Date(l),o=new Date(l);n.setTime(n.getTime()+864e5*j),o.setTime(o.getTime()+864e5*k),$("#target_shipping_date").mousedown(function(){$(this).datepicker(),$(this).datepicker("option",{dateFormat:"yy-mm-dd",showAnim:"",minDate:n,maxDate:o})}).change(function(){var a=$(this).val(),b=new Date(a.replace(/-/g,"/"));if(null==b||n>b||b>o){alert("您输入的时间有误！");var c=parseInt(o.getMonth())+1,d=o.getDate(),e=c>9?c+"":"0"+c,f=d>9?d+"":"0"+d;$(this).val(o.getFullYear()+"-"+e+"-"+f)}}),$(".gateway_list li").click(function(){$(this).hasClass("desc")||$(this).hasClass("weihu")||($(".gateway_list li input").removeAttr("checked"),$(".gateway_list li").removeClass("selected"),$(this).addClass("selected").children("input").attr("checked","checked"),$("#paytype_balance_info").css("visibility","visible"),$("#use_balance_checkbox").css("visibility","visible"))})},enableDefaultValue:function(){$("#gateway_list input[value="+Jumei.Order.DefaultValue.payment_method+"]").trigger("click"),$("#address_selector input[value="+Jumei.Order.DefaultValue.address_id+"]").trigger("click"),$("#prefer_delivery_day input[value="+Jumei.Order.DefaultValue.prefer_delivery_day+"]").trigger("click")},setDefaultValue:function(a){a&&(Jumei.Order.DefaultValue=a),"0"==Jumei.Order.DefaultValue.address_id&&$("#address_table").show()},cart_item_quantity_change:function(a){var b=parseInt(a.attr("user_purchase_limit")),c=parseInt(a.val()),d=a.attr("cart_key"),e=a.attr("item_key");isNaN(c)&&(c=0),1>c&&(c=1),c>20&&(c=20),a.val(c),0!=b&&c>b?(c=b,a.val(c),alert("您最多能够购买 "+b+" 件该商品!")):$.ajax({url:"http://cart.jumei.com/i/cart/ajax_update_cart",type:"POST",dataType:"text",data:{_ajax_:1,cart_key:d,item_quantity:c,item_key:e},success:function(a){var a=$.parseJSON(a);$("#J_redeem_amount").val(a.redeem_amount),Jumei.Order.caculate_amount_func(),Jumei.Order.changeHuangouStatus(a.redeem_amount),is_semwinner&&Jumei.Order.enableADWQTracking.track_add("cart"),Jumei.Order.enableGATracking.track_add("quantity_change_old")}})},caculate_amount_func:function(){var a=$("#cart_products"),b=0,c=0,d=!1,e=!1,f=$("#focus_amount"),g=0;a.find(".item-buy-quantity-input").each(function(){var a=$(this),f=a.closest("tr"),h=parseInt($(this).val());isNaN(h)&&(h=0),1>h&&(h=1),h>20&&(h=20),b+=h;var i=$(this).attr("item_key"),j=parseFloat(h*$("#item-buy-price-"+i).html());c+=j,f.hasClass("focus_item")&&(g+=j),"lottery"==$(this).attr("category")&&(d=!0),"1"==$(this).attr("is_b2c_item")&&(e=!0),$("#item-buy-total-"+i).html(j.toFixed(2))});var h=c;$("#item-buy-total-t").html(h.toFixed(2)),$("#J_redeem_amount").val(h.toFixed(2)),f.length&&f.html(g.toFixed(2))},clear_cart:function(){$.ajax({url:"http://cart.jumei.com/i/cart/ajax_clear_cart",type:"POST",dataType:"text",data:{}})},load_shipping:function(a,b){var c=!1,d=$("#shipping_selector"),e=$("#merge_shipping_title"),f=$("#merge_shipping_list"),g=$("#delivery_fee_view");$("#merge_shipping_list .shipping_no").each(function(){var h=a+"_"+b,i=!1;if($(this).attr("alt")!=h?$(this).css("display","none"):(i=!0,$(this).css("display","block")),c=c||i)e.show(),"merge"==d.find("input[name='shipping_option']:checked").val()&&f.show();else if(e.hide(),f.hide(),"merge"==d.find("input[name='shipping_option']:checked").val()){g.html($("#delivery_fee").val());var j=parseFloat(g.html())+parseFloat($("#cart_total").val());$("#total_amount").text(j.toFixed(2)),d.find("input[name='shipping_option'][value='instant']").attr("checked",!0)}})},showCancelSuccessDialog:function(a){var b=['<div class="cancel_success_layer" style="display:block;">','<div class="to-show" style="width: 350px;float: left;height: 25px;font-weight: bold;color: #ed145b;background: #f2f2f2;padding-top: 5px;"><span style="font-size: 14px;margin: 0 20px;">温馨提示</span></div>','<div class="cancel_success_layer_wrap">','<div class="cancel_success_input_wrap content">',"<p>",'<span class="img_ok">已取消成功!</span>','<p class="rma_link">您可在“<a href="/i/RMA/list/" target="_blank">我的退货进度</a>”中关注退款情况!</p>',"</div>",'<div class="cancel_success_input_wrap" style="text-align:center;margin-top:10px;">','<a class="cancel_success_input_tip not-show" href="javascript:void(0);" onclick="$(\'#cboxClose\').click();">',"确定","</a>","</div>","</div>","</div>"].join(""),c=$(b);a||c.find(".rma_link").hide(),$.colorbox({html:c.html(),onClosed:function(){window.location.reload()},overlayClose:!1,escKey:!1})},cancel:function(){var a,b,c,d=50,e="请您描述下具体原因，以帮助我们更好的提供服务（"+d+"字以内）";$(".order-cancel").click(function(f){f.preventDefault(),$this=$(this),$.ajax({url:"/i/order/ajax_cancel_order",data:{order_id:$this.attr("order-id")},dataType:"JSON",type:"GET",success:function(f){if(f=$.parseJSON(f),1==f.status){var g='<option value="0">请选择取消理由</option>';for(var h in f.reasons)g+='<option value="'+h+'">'+f.reasons[h]+"</option>";$("#select_reasons").html(g),a||(a=$(".dialog_s").show().dialog(),b=$(a.dialog),c=b.find("select"),b.find(".close").click(function(){c.val("0")}),b.find(".btn_mid_pink").click(function(){var d=c.val();if("0"===$.trim(d))return alert("请您选择取消理由"),void 0;var f=$.trim(b.find("textarea").val());f==e&&(f=""),$.ajax({url:"/i/order/ajax_cancel?order_id="+$this.attr("order-id"),data:{reason:d,txt:f},type:"POST",dataType:"JSON",success:function(b){b=$.parseJSON(b),a.hide(),c.val("0"),0==b.status?alert(b.msg):-1==b.status?alert("请先登录！"):b.msg?Jumei.Order.showCancelSuccessDialog(!0):Jumei.Order.showCancelSuccessDialog()},error:function(){alert("好像是网络不给力，请稍候再试哦")}})}),b.find(".btn_mid_grey").click(function(){a.hide(),c.val("0")}),b.find("textarea").focus(function(){var a=$(this);$.trim(a.val())==e&&a.val("").css("color","#333")}).blur(function(){var a=$(this);""==$.trim(a.val())&&a.val(e).css("color","#aaa")}).keyup(function(){var a=$(this).val().replace(/^\s+/,""),c=a.length;a.length>d&&($(this).val(a.slice(0,d)),c=d),b.find(".input_error").html("您还可以输入"+(d-c)+"字")}));var i="<span>您确定要取消吗？</span> <br>确认取消后不可恢复，使用的现金券将会恢复正常。";return 1!=$this.attr("presale")||13!=$this.attr("order-status")&&14!=$this.attr("order-status")||(i="<span>您确认要退订金吗？</span> <br>确认取消后，订金将在7个工作日内原路径退款给您。"),1!=$this.attr("presale")||1!=$this.attr("order-status")&&2!=$this.attr("order-status")||(i="<span>您确定要取消吗？</span> <br>确认取消后不可恢复。"),$(this).hasClass("cancel-red-envelope")&&(i="<span>红包每人仅限购买一个。</span><br>若取消红包，将无法再次购买红包喔！"),b.find("textarea").val(e).css("color","#aaa"),b.find(".alert_con").html(i),b.find(".input_error").html(""),a.show(),!1}0==f.status?alert(f.msg):-1==f.status&&alert("请先登录！")},error:function(){alert("好像是网络不给力，请稍候再试哦")}})})},update_checkout_amount:function(){var a=parseFloat($("input[name='cart_total']").val()),b=parseFloat($("input[name='delivery_fee']").val()),c=parseFloat($("input[name='promo_cards_reduction_amount']").val()),d=parseFloat($("input[name='merge_shipping_delivery_fee_redcuction']").val()),e=parseFloat($("input[name='delivery_fee_reduction']").val()),f=Math.max(e,d);f>0?($("#final_delivery_fee_redunction_notice").css("display","block"),$("#final_delivery_fee_redunction_amount").html(f)):$("#final_delivery_fee_redunction_notice").css("display","none"),c>0?($("#promo_card_reduction_notice").css("display","block"),$("#promo_card_reduction_amount").html(c)):$("#promo_card_reduction_notice").css("display","none"),$("#delivery_fee_view").html(b);var g=Math.max(0,a+b-f-c).toFixed(2);$("#total_amount").text(g);var h=parseFloat($("#account_balance").text());if(g>h+1e-6){var i='帐户余额：<span><font>¥</font><span id="account_balance">'+h.toFixed(2)+"</span></span> 您的余额不够完成本次付款，还需支付 <span><font>¥</font>"+(g-h).toFixed(2)+"</span>。请选择支付方式";$("#paytype_balance_info").html(i),$("#paytype_gateway").css("display","block")}else{var i='帐户余额：<span><font>¥</font><span id="account_balance">'+h.toFixed(2)+'<span id="paytype_balance" style="color:#333;">您可以用余额支付</span>';$("#paytype_balance_info").html(i),$("#paytype_gateway").remove()}},addSaleGiftToCart:function(){var a=function(){var a="http://cart."+RM_SITE_MAIN_TOPLEVELDOMAINNAME+"/i/cart/new_items/";if(!$(this).parent().parent().hasClass("enable"))return!1;if($(this).hasClass("selected"))return!1;if($(this).hasClass("sold_out"))return alert("此商品已抢光，换一个吧"),!1;$(".sale_gifts_selector li").removeClass("selected"),$(this).addClass("selected");var b=$(this).attr("hash_id"),c=$(this).attr("sku_no"),d=a+c+","+b+",1";Jumei.Core.ga_event("addtocart",RM_CONTROL+"_"+RM_ACTION,b),window.location.href=d},b=function(){var a=$(".sale_gifts_selector");if(a.length>0){var b=!0;if($(".cart_products .cart_item").each(function(){var a=$(this).attr("deal_hash_id");$("#gift_"+a).length>0&&!$("#gift_"+a).parent().parent().hasClass("enable")&&(alert("请删除不符合满赠规则的商品，再去结算：）"),b=!1)}),a.find(".enable").length>0&&3!=a.find(".enable li.sold_out").length&&0==a.find("li.selected").length&&!confirm("您还没有选择赠品，确定不要赠品去支付么？"))return!1;b&&(window.location.href="http://cart.jumei.com/i/cart/confirmation")}else window.location.href="http://cart.jumei.com/i/cart/confirmation";window.event&&(window.event.returnValue=!1)};$(".sale_gifts_selector").length>0&&(Jumei.Order.changeSaleGiftBoxItemStatus(),$(".sale_gifts_selector li").click(a),$("#go_to_order").attr("href","javascript:void(0)").click(b))},changeSaleGiftBoxItemStatus:function(){var a=$(".cart_products .cart_item"),b=$(".sale_gifts_selector .level li"),c=$(".sale_gifts_selector .level"),d=a.length,e=b.length,f=!1;if(1>e)return!1;for(var g=0;d>g;g++)for(var h=0;e>h;h++)if($(a[g]).attr("deal_hash_id")==$(b[h]).attr("hash_id")){$(b[h]).addClass("selected"),f=!0;break}var i=parseFloat($("#J_redeem_amount").val());c.each(function(){var a=parseFloat($(this).attr("level"));i>=a?$(this).addClass("enable"):$(this).removeClass("enable")}),f||$(b).removeClass("selected")},enableCreditTopupLightbox:function(){$("#order-pay-form").length>0&&$("#order-pay-form").submit(function(){return"0"==$("#order-pay-form").attr("is_balance_payment")?(Jumei.Core.lightbox.init({url:"/payment_confirm.html?cache=0",callback:function(){},shadow:!0,sTop:150}),!0):void 0}),$("#check_pay_form").length>0&&$("#check_pay_form").submit(function(){return"0"==$("#check_pay_form").attr("is_balance_payment")&&Jumei.Core.lightbox.init({url:"/payment_confirm.html?cache=0",callback:function(){},shadow:!0,sTop:150}),!0})},changeSaleStatusText:function(a){var b=$("#J_StatusBox");b&&(198>a?b.html('圣诞大促期间全场包邮，满198元返100，满298元返200！<br>本单再加<span class="pink">'+(198-a).toFixed(2)+'元</span>商品即赠2张<span class="pink">50元现金券</span>（满249元使用）！'):298>a?b.html('圣诞大促期间全场包邮，满198元返100，满298元返200！！<br>本单已满<span class="pink">198元</span>，下单后返2张价值<span class="pink">50元现金券</span>（满249元使用）！'):b.html('圣诞大促期间全场包邮，满198元返100，满298元返200！<br>本单已满<span class="pink">298元</span>，下单后返4张价值<span class="pink">50元现金券</span>（满249元使用）！'))},enableAjaxCrossale:function(){$("#cart_other_products .mall_box");var a=getUrlArgs("from");return Jumei.Core.global_ajax?($.ajax({type:"POST",url:"http://cart.jumei.com/i/cart/getCartRecommendations",success:function(b){var b=$.parseJSON(b);if(null!=b){var c=function(b,c){var d=$("#product_list_"+c),e=$("#featured_"+c);if(b.length>=4){for(var f=b,g="",h=f.length,i=0;h>i&&10>i;i++){var j="",k=f[i].hash_id,l=f[i].product_id,m=f[i].discounted_price,n=f[i].image_url+"_std/"+l+"_160_160.jpg",o=f[i].short_name,p=f[i].discount,q="",r=f[i].buy_number,s="",t=f[i].original_price,u="",v=f[i].type,w=f[i].deal_category;if(parseFloat(p)<9.5&&(q='<span class="discount">'+p+"折/</span>"),""!=r&&"undefined"!=typeof r&&(s='<p class="buyer_num">最近<span class="blue">'+r+"</span>人购买</p>"),""!=t&&(u='<span class="grey">¥'+t+"</span>"),"deal"==v){j="flow_cart_"+c+"_addtocart_"+k;var x=RM_CURRENT_SITE_MAIN_WEBBASEURL;"media"==w&&(x="http://pop."+RM_SITE_MAIN_TOPLEVELDOMAINNAME);var y=x+"/i/deal/"+k+".html?from="+j+addcart_abtest_now,z='<li class="cross_sale_deal" deal_hash_id="'+k+'"><div class="pic"><a href="'+y+'" target="_blank"><img src="'+n+'" /></a></div><div class="name"><a href="'+y+'" target="_blank">'+q+o+'</a></div><div class="price"><span>¥'+m+"</span>"+u+"</div>"+s+'<div class="button"><a href="javascript:void(0)" class="link" product_id="'+l+'" hash_id="'+k+'"><img alt="加入购物车" src="'+RM_IMGDIR+'/cart_v2/btn_small_pink.jpg" /></a></div></li>'}else if("mall"==v){j="flow_cart_"+c+"_addtocart_"+l;var y="http://mall."+RM_SITE_MAIN_TOPLEVELDOMAINNAME+"/product_"+l+".html?from="+j+addcart_abtest_now,z='<li class="cross_sale_deal mall_product"><div class="pic"><a href="'+y+'" target="_blank"><img src="'+n+'" /></a></div><div class="name"><a href="'+y+'" target="_blank">'+q+o+'</a></div><div class="price"><span>¥'+m+"</span>"+u+"</div>"+s+'<div class="button"><a href="'+y+'" class="link" target="_blank" product_id="'+l+'"><img alt="加入购物车" src="'+RM_IMGDIR+'/cart_v2/btn_small_pink.jpg" /></a></div><select class="sku_select"></select></li>'}g+=z}d.html(g);var A=d.find("li.cross_sale_deal a.link");A.click(function(b){b.preventDefault();var d=$(this),e=d.closest("li.mall_product"),f=e.find(".sku_select"),g=(d.attr("href"),"?from="+a+"|flow_cart_cross_"+c+"_addtocart"),h="undefined"!=typeof d.attr("hash_id")?d.attr("hash_id"):"";id=d.attr("product_id"),$.ajax({url:"/i/ajax/get_sku_data?type=product&id="+id,success:function(a){var a=$.parseJSON(a),b=0,c=a.length,e='<option value="">请选择型号</option>',i="",j="";if(null==a||void 0==a)return d.find("img").attr("src","http://p0.jmstatic.com/templates/jumei/images/mall/sold_out_button.jpg"),void 0;if(1==c){var k=a[0],l=k.sku_sellable,m=k.sku_no;return 0==l?(d.find("img").attr("src","http://p0.jmstatic.com/templates/jumei/images/mall/sold_out_button.jpg"),void 0):(j=m+","+h+",1",Jumei.Core.ga_event("addtocart",RM_CONTROL+"_"+RM_ACTION,j),location.href="http://cart."+RM_SITE_MAIN_TOPLEVELDOMAINNAME+"/i/cart/new_items/"+j+g,void 0)}for(var n=0,o="";c>b;b++){var k=a[b],l=k.sku_sellable,m=k.sku_no,p=k.sku_attribute;l>0&&(i+='<option value="'+m+'">'+p+"</option>",o+=m+","+h+",1",n++)}return 1==n?(Jumei.Core.ga_event("addtocart",RM_CONTROL+"_"+RM_ACTION,o),location.href="http://cart."+RM_SITE_MAIN_TOPLEVELDOMAINNAME+"/i/cart/new_items/"+o+g,void 0):(""!=i?(d.hide(),f.html(e+i).show()):""==i&&d.find("img").attr("src","http://p0.jmstatic.com/templates/jumei/images/mall/sold_out_button.jpg"),f.change(function(){var a=$(this).val(),b=a+","+h+",1";0!=a&&(Jumei.Core.ga_event("addtocart",RM_CONTROL+"_"+RM_ACTION,b),location.href="http://cart."+RM_SITE_MAIN_TOPLEVELDOMAINNAME+"/i/cart/new_items/"+b+g)}),void 0)}})}),e.show()}else e.remove()};for(var d in b){var e=b[d],f=d;c(e,f)}}}}),void 0):!1},enableGATracking:{track_add:function(a){_gaq.push(["_trackEvent","cart_add",a]);var b,c,d,e,f,g,h,i=$("#cart_products .cart_item"),j="undefined"!=typeof i?i.length:0;if(0>=j)return!1;for(var k=0;j>k;k++)b=$(i[k]),c=b.attr("product_id")||b.attr("deal_hash_id"),d=$.trim(b.find(".name a").html()),e=parseFloat(b.find(".price_box span").html()),f=parseInt(b.find(".item-buy-quantity-input").val()),g="undefined"!=typeof b.attr("product_id")?"product":"deal",h=g,_gaq.push(["_addItem","",c,d,g,e,f]);_gaq.push(["_trackTrans"])},track_confirmation:function(a){_gaq.push(["_trackEvent","cart_confirmation",a])},track_pay:function(a){_gaq.push(["_trackEvent","cart_pay",a])},track_check:function(a){_gaq.push(["_trackEvent","cart_check",a])},track_payment:function(){_gaq.push(["_trackEvent","cart_payment_status","view"]);var a=$(".pay_status .order_status tr"),b="undefined"!=typeof a?a.length:0;if(b>0){for(var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=0;b>q;q++){d=$(a[q]).attr("order_info"),j=null==$(a[q]).attr("is_cod")?"normal":"cod",e=$(a[q]).closest(".order_status").hasClass("order_status_success")?"success":"fail";var r=$.parseJSON(d);if(1==r.status){f=r.order,c=parseInt(f.order_id),h=parseFloat(f.total_price),i=new Date,i.setTime(1e3*RM_SERVER_TIME),_gaq.push(["_addTrans",c,i,h,e,j,"","",""]),g=f.item_details;for(var s in g){var s=g[s];k=s.deal_hash_id.length>0?s.deal_hash_id:s.product_id,l=s.deal_short_name,m=s.deal_price,n=s.quantity,o=s.deal_hash_id.length>0?"deal":"product",p=o,_gaq.push(["_addItem",c,k,l,o,m,n])}}}_gaq.push(["_trackTrans"])}}},enableEcommerceTracking:function(){var _$orderPaymentSuccess=$("#cart .order_status_success tr");_$orderPaymentSuccess.length>0&&_$orderPaymentSuccess.each(function(){var orderInfo=$(this).attr("order_info");if(null!=orderInfo&&orderInfo.length>0){var data=jQuery.parseJSON(orderInfo);if(1==data.status){var order=data.order;with(order){window._gaq=window._gaq||[],_gaq.push(["_addTrans",order_id,"cosmetics.store.jumei",total_price,"",delivery_fee,"","",""]);for(var item in item_details)with(item_details[item])_gaq.push(["_addItem",order_id,deal_hash_id,deal_short_name,attribute_selections,deal_price,quantity])}_gaq.push(["_trackTrans"])}}})},enableADWQTracking:{track_add:function(a){var b,c,d,e,f,g,h,i=$("#cart_products .cart_item"),j="undefined"!=typeof i?i.length:0;if(0>=j)return!1;_adwq.push(["_setDataType",a]),null!=RM_UID?_adwq.push(["_setCustomer",RM_UID]):_adwq.push(["_setCustomer","NOT_LOGIN"]);for(var k=0;j>k;k++)b=$(i[k]),c=b.attr("product_id")||b.attr("deal_hash_id"),d=$.trim(b.find(".name a").html()),e=parseFloat(b.find(".price_box span").html()),f=parseInt(b.find(".item-buy-quantity-input").val()),g="undefined"!=typeof b.attr("product_id")?"product":"deal",h=g,_adwq.push(["_setItem",c,d,e,f,g,h]);_adwq.push(["_trackTrans"])},track_pay:function(){var a=$("#cart .order_info_val"),b="undefined"!=typeof a?a.length:0;if(b>0){for(var c,d,e,f,g,h,i,j,k,l="",m=0,n="_",o=[],p=0;b>p;p++){p==b-1&&(n=""),c=$(a[p]).attr("order_info");var q=$.parseJSON(c);1==q.status&&(d=q.order,l+=parseInt(d.order_id)+n,m+=parseFloat(d.total_price),e=d.item_details,o.push(e))}if(l.length>0){_adwq.push(["_setDataType","order"]),_adwq.push(["_setCustomer",RM_UID]),_adwq.push(["_setOrder",l,m,""]);for(var p=0;p<o.length;p++){var e=o[p];for(var r in e){var r=e[r];f=r.deal_hash_id.length>0?r.deal_hash_id:r.product_id,g=r.deal_short_name,h=r.deal_price,i=r.quantity,j=r.deal_hash_id.length>0?"deal":"product",k=j,_adwq.push(["_setItem",f,g,h,i,j,k])}}_adwq.push(["_trackTrans"])}}}}};